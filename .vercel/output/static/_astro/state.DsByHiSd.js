let o=[],v=0;const m=4;let T=0,w=e=>{let n=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},lc:0,listen(s){return t.lc=n.push(s),()=>{for(let i=v+m;i<o.length;)o[i]===s?o.splice(i,m):i+=m;let l=n.indexOf(s);~l&&(n.splice(l,1),--t.lc||t.off())}},notify(s,l){T++;let i=!o.length;for(let a of n)o.push(a,t.value,s,l);if(i){for(v=0;v<o.length;v+=m)o[v](o[v+1],o[v+2],o[v+3]);o.length=0}},off(){},set(s){let l=t.value;l!==s&&(t.value=s,t.notify(l))},subscribe(s){let l=t.listen(s);return s(t.value),l},value:e};return t};const S=5,p=6,L=10;let M=(e,n,t,s)=>(e.events=e.events||{},e.events[t+L]||(e.events[t+L]=s(l=>{e.events[t].reduceRight((i,a)=>(a(i),i),{shared:{},...l})})),e.events[t]=e.events[t]||[],e.events[t].push(n),()=>{let l=e.events[t],i=l.indexOf(n);l.splice(i,1),l.length||(delete e.events[t],e.events[t+L](),delete e.events[t+L])}),U=1e3,O=(e,n)=>M(e,s=>{let l=n(s);l&&e.events[p].push(l)},S,s=>{let l=e.listen;e.listen=(...a)=>(!e.lc&&!e.active&&(e.active=!0,s()),l(...a));let i=e.off;return e.events[p]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let a of e.events[p])a();e.events[p]=[]}},U)},()=>{e.listen=l,e.off=i}}),I=(e,n,t)=>{Array.isArray(e)||(e=[e]);let s,l,i=()=>{if(l===T)return;l=T;let d=e.map(u=>u.get());if(!s||d.some((u,r)=>u!==s[r])){s=d;let u=n(...d);u&&u.then&&u.t?u.then(r=>{s===d&&a.set(r)}):(a.set(u),l=T)}},a=w(void 0),E=a.get;a.get=()=>(i(),E());let y=i;return O(a,()=>{let d=e.map(u=>u.listen(y));return i(),()=>{for(let u of d)u()}}),a},R=(e,n)=>I(e,n),_=(e={})=>{let n=w(e);return n.setKey=function(t,s){let l=n.value;typeof s>"u"&&t in n.value?(n.value={...n.value},delete n.value[t],n.notify(l,t)):n.value[t]!==s&&(n.value={...n.value,[t]:s},n.notify(l,t))},n},N=e=>e,h={},c={addEventListener(){},removeEventListener(){}};function A(){try{return typeof localStorage<"u"}catch{return!1}}A()&&(h=localStorage);let Q={addEventListener(e,n,t){window.addEventListener("storage",n),window.addEventListener("pageshow",t)},removeEventListener(e,n,t){window.removeEventListener("storage",n),window.removeEventListener("pageshow",t)}};typeof window<"u"&&(c=Q);function q(e,n={},t={}){let s=t.encode||N,l=t.decode||N,i=_(),a=i.setKey,E=(r,f)=>{typeof f>"u"?(t.listen!==!1&&c.perKey&&c.removeEventListener(e+r,d,u),delete h[e+r]):(t.listen!==!1&&c.perKey&&!(r in i.value)&&c.addEventListener(e+r,d,u),h[e+r]=s(f))};i.setKey=(r,f)=>{E(r,f),a(r,f)};let y=i.set;i.set=function(r){for(let f in r)E(f,r[f]);for(let f in i.value)f in r||E(f,void 0);y(r)};function d(r){r.key?r.key.startsWith(e)&&(r.newValue===null?a(r.key.slice(e.length),void 0):a(r.key.slice(e.length),l(r.newValue))):y({})}function u(){let r={...n};for(let f in h)f.startsWith(e)&&(r[f.slice(e.length)]=l(h[f]));for(let f in r)i.setKey(f,r[f])}return O(i,()=>{if(u(),t.listen!==!1)return c.addEventListener(e,d,u),()=>{c.removeEventListener(e,d,u);for(let r in i.value)c.removeEventListener(e+r,d,u)}}),i}const C=w(!1),g=q("cart",{},{encode:JSON.stringify,decode:JSON.parse});function J({id:e,name:n,imageSrc:t,price:s,quantity:l}){const i=g.get()[e];i?g.setKey(e,{...i,quantity:i.quantity+l}):g.setKey(e,{id:e,name:n,imageSrc:t,price:s,quantity:l}),console.log(g.get())}function P(){g.set({})}const W=R(g,e=>Object.values(e).reduce((n,t)=>n+t.quantity,0));export{P as a,J as b,g as c,W as g,C as i};
