let d=[],c=0;const m=4;let T=0,w=e=>{let n=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},lc:0,listen(s){return t.lc=n.push(s),()=>{for(let i=c+m;i<d.length;)d[i]===s?d.splice(i,m):i+=m;let l=n.indexOf(s);~l&&(n.splice(l,1),--t.lc||t.off())}},notify(s,l){T++;let i=!d.length;for(let a of n)d.push(a,t.value,s,l);if(i){for(c=0;c<d.length;c+=m)d[c](d[c+1],d[c+2],d[c+3]);d.length=0}},off(){},set(s){let l=t.value;l!==s&&(t.value=s,t.notify(l))},subscribe(s){let l=t.listen(s);return s(t.value),l},value:e};return t};const S=5,p=6,L=10;let M=(e,n,t,s)=>(e.events=e.events||{},e.events[t+L]||(e.events[t+L]=s(l=>{e.events[t].reduceRight((i,a)=>(a(i),i),{shared:{},...l})})),e.events[t]=e.events[t]||[],e.events[t].push(n),()=>{let l=e.events[t],i=l.indexOf(n);l.splice(i,1),l.length||(delete e.events[t],e.events[t+L](),delete e.events[t+L])}),U=1e3,O=(e,n)=>M(e,s=>{let l=n(s);l&&e.events[p].push(l)},S,s=>{let l=e.listen;e.listen=(...a)=>(!e.lc&&!e.active&&(e.active=!0,s()),l(...a));let i=e.off;return e.events[p]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let a of e.events[p])a();e.events[p]=[]}},U)},()=>{e.listen=l,e.off=i}}),I=(e,n,t)=>{Array.isArray(e)||(e=[e]);let s,l,i=()=>{if(l===T)return;l=T;let o=e.map(u=>u.get());if(!s||o.some((u,r)=>u!==s[r])){s=o;let u=n(...o);u&&u.then&&u.t?u.then(r=>{s===o&&a.set(r)}):(a.set(u),l=T)}},a=w(void 0),E=a.get;a.get=()=>(i(),E());let h=i;return O(a,()=>{let o=e.map(u=>u.listen(h));return i(),()=>{for(let u of o)u()}}),a},R=(e,n)=>I(e,n),_=(e={})=>{let n=w(e);return n.setKey=function(t,s){let l=n.value;typeof s>"u"&&t in n.value?(n.value={...n.value},delete n.value[t],n.notify(l,t)):n.value[t]!==s&&(n.value={...n.value,[t]:s},n.notify(l,t))},n},N=e=>e,y={},g={addEventListener(){},removeEventListener(){}};function A(){try{return typeof localStorage<"u"}catch{return!1}}A()&&(y=localStorage);let Q={addEventListener(e,n,t){window.addEventListener("storage",n),window.addEventListener("pageshow",t)},removeEventListener(e,n,t){window.removeEventListener("storage",n),window.removeEventListener("pageshow",t)}};typeof window<"u"&&(g=Q);function C(e,n={},t={}){let s=t.encode||N,l=t.decode||N,i=_(),a=i.setKey,E=(r,f)=>{typeof f>"u"?(t.listen!==!1&&g.perKey&&g.removeEventListener(e+r,o,u),delete y[e+r]):(t.listen!==!1&&g.perKey&&!(r in i.value)&&g.addEventListener(e+r,o,u),y[e+r]=s(f))};i.setKey=(r,f)=>{E(r,f),a(r,f)};let h=i.set;i.set=function(r){for(let f in r)E(f,r[f]);for(let f in i.value)f in r||E(f,void 0);h(r)};function o(r){r.key?r.key.startsWith(e)&&(r.newValue===null?a(r.key.slice(e.length),void 0):a(r.key.slice(e.length),l(r.newValue))):h({})}function u(){let r={...n};for(let f in y)f.startsWith(e)&&(r[f.slice(e.length)]=l(y[f]));for(let f in r)i.setKey(f,r[f])}return O(i,()=>{if(u(),t.listen!==!1)return g.addEventListener(e,o,u),()=>{g.removeEventListener(e,o,u);for(let r in i.value)g.removeEventListener(e+r,o,u)}}),i}const q=w(!1),v=C("cart",{},{encode:JSON.stringify,decode:JSON.parse});function K({id:e,name:n,imageSrc:t,price:s,quantity:l}){const i=v.get()[e];i?v.setKey(e,{...i,quantity:i.quantity+l}):v.setKey(e,{id:e,name:n,imageSrc:t,price:s,quantity:l}),console.log(v.get())}function J(e){v.setKey(e,void 0)}function P(){v.set({})}const W=(e,n)=>{const t=v.get()[e];v.setKey(e,{...t,quantity:n})},k=R(v,e=>Object.values(e).reduce((n,t)=>n+t.quantity,0));export{P as a,K as b,v as c,k as g,q as i,J as r,W as u};
